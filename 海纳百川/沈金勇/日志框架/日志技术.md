# 日志技术（上）

## 0.学习目标

1. 日志的作用和目的
2. 日志的框架
3. JUL的使用
4. LOG4J的使用
5. JCL的使用

## 1.日志的概念

### 1.1日志文件

**日志文件是用于记录系统操作时间的文件集合。**

可分为时间日志和消息日志，举由处理历史数据，诊断问题的追踪以及理解系统的活动等重要作用。

在计算机中，日志文件是记录在操作系统、其他软件运行中发生的事件或在通信软件的不同用户之间的消息文件。记录时保持日志的行为。在最简单的情况下，消息被写入单个日志文件。

许多操作系统，软件框架和程序包括日志系统，广泛使用的日志记录标准是在因特网工程任务组（IETF）REC5424中定义的syslog。syslog标准使专用的标准化子系统能够生成、过滤、记录和分析日志消息。

#### 1.1.1调试日志

软件开发中，我们经常需要去调试程序，做一些信息和状态的输出便于我们询程序的运行情况。为了让我们能够更加灵适和方便的控制这些调试的信息，所有我们需要专业的日志技术。

java中寻找bug会需要重现。调试也就是debug可以在程序运行中暂停程序运行，可以查看程序在运行中的情况，日志主要是为了方便的去重现问题。

#### 1.1.2 系统日志

系统日志是记录系统中硬件、软件和系统问题的信息。同时还可以监视系统中发生的事件。用户可以通过它来检查错误发生的原因，或者寻找受到攻击时攻击者留下的痕迹。系统日志包括系统日志、应用程序日志和安全日志。

> 系统日志的价值

系统日志策略可以在故障刚刚发生时就向你发送警告信息，系统日志帮助你在最短的时间内发现问题。

系统日志时一种非常关键的组件，因为系统日志可以让你充分了解自己的环境，这种系统日志信息对于决定故障的根本原因或者缩小系统攻击范围来说是非常关键的，因为系统日志可以让你了解故障或者袭击发生之前的所有事件。

为虚拟化环境制定一套良好的系统日志策略也是至关重要的，因为系统日志需要和许多不同的外部组件进行关联。

良好的系统日志可以防止你从错误的角度分析问题，避免浪费宝贵的排错时间。另外一种原因是借助于系统日志，管理员很有可能会发现一些之前从未意识到的问题，在几乎所有刚刚部署系统日志的环境当中。

## 2.Java日志框架

问题：

1. 控制日志输出大的内容和格式
2. 控制日志输出的位置
3. 日志优化：异步日志、日志文件的归档和压缩
4. 日志系统的维护
5. 面向接口开发-日志的门面

### 2.1为什么要用日志框架

因为软件系统发展到今天已经很复杂了，特别是服务器端软件，涉及到的知识，内容，问题太多。在某些方面使用别人成熟的框架，就相当于让别人帮你完成一些基础工作，你只需要集中精力完成系统的业 务逻辑设计。而且框架一般是成熟，稳健的，他可以处理系统很多细节问题，比如，事务处理，安全性，数据流控制等问题。还有框架一般都经过很多人使用，所以结构很好，所以扩展性也很好，而且它是不断升级的，你可以直接享受别人升级代码带来的好处。

### 2.2现有的日志框架

- JUL（java util logging）、logback、log4j、log4j2

- JCL（Jakarta Commons Logging）、slf4j（ Simple Logging Facade for Java）

**日志门面**

JCL、slf4j

**日志实现**

JUL、logback、log4j、log4j2

## 3.JUL学习

JUL全称Java util Logging是java原生的日志框架，使用时不需要另外引用第三方类库，相对其他日志框 架使用方便，学习简单，能够在小型应用中灵活使用。

### 3.1JUL入门

### 3.1.1架构介绍

![./images/JUL架构介绍.png](C:\Users\admin\Desktop\Java-notes\海纳百川\沈金勇\日志框架\images\JUL框架介绍.png)

- Loggers：被称为记录器，应用程序通过获取Logger对象，调用其API来发布日志信息。Logger 通常是应用程序访问日志系统的入口程序。
- Appenders：也被称为Handlers，每个Logger都会关联一组Handlers，Logger会将日志交给关联 Handlers处理，由Handlers负责将日志做记录。Handlers在此是一个抽象，其具体的实现决定了日志记录的位置可以是控制台、文件、网络上的其他日志服务或操作系统日志等。
- Layouts：也被称为Formatters，它负责对日志事件中的数据进行转换和格式化。Layouts决定了数据在一条日志记录中的最终形式。
- Level：每条日志消息都有一个关联的日志级别。该级别粗略指导了日志消息的重要性和紧迫，我可以将Level和Loggers，Appenders做关联以便于我们过滤消息。
- Filters：过滤器，根据需要定制哪些信息会被记录，哪些信息会被放过。

### 3.1.2快速入门

```java
@Test
void contextLoads() {

    // 获取日志记录器对象
    Logger logger = Logger.getLogger("com.simpleteen.QuickStartApplicationTests");
    // 日志记录输出
    logger.info("hello world!");
    // 通用方法进行日志输出
    logger.log(Level.INFO,"info message");
    // 通用占位符 方式输出变量值
    String name = "美少女永远";
    Integer age = 18;
    logger.log(Level.INFO,"口号：{0}{1}",new Object[]{name,age});

}
```

日志的级别：

- OFF: 日志的开关，关
- SEVERE:最高级别，错误信息
- WARNING：警告信息
- INFO：消息记录，比如数据库的连接信息、IO的传递信息和网络通讯的信息
- CONFIG：配置信息
- FINE：deubg日志记录
- FINER：debug日志记录
- FINEST：debug日志记录
- ALL：日志的开关，开

java.util.logging的默认级别是info

### 自定义日志级别

1. 创建日志记录器对象
2. 关闭系统日志默认配置
3. 创建handler对象，输出到控制台
4. 创建formatter对象
5. 进行关联
6. 设置日志级别
7. 日志输出

### Logger对象父子关系

所有日志记录器：

- 顶级父元素 LogManagersRootLogge
- name为空字符串

### 日志的配置文件

%h：当前的用户目录

%u: 数字取值

### ConsoleHandler

默认参数：

- .level 日志级别
- .filter 过滤器
- .formatter 日志格式对象
- .format 日志消息格式
- .encoding 日志编码
- .append 指定以追加的方式添加日志，默认为false