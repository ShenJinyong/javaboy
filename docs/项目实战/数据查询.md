# 数据查询

## @Options注解

当一个表有亿级别的数据，我们想不用索引的情况下一次性查出所有数据，存在的问题：

- 速度缓慢
- 有可能导致超时
- 将几百万的数据存入集合对象很容易OOM

因为存入的数据都是强引用，直至OOM之前都不会被GC，所以这种情况下最好采用流式查询，一次只查询出1000条（自定义），来进行逐步的查询和获取

```java
@Options(resultSetType = ResultSetType.FORWARD_ONLY, fetchSize=10000)
```

源码分析

```java
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD})
@Repeatable(Options.List.class)
public @interface Options {
    boolean useCache() default true;

    Options.FlushCachePolicy flushCache() default Options.FlushCachePolicy.DEFAULT;

    ResultSetType resultSetType() default ResultSetType.DEFAULT;

    StatementType statementType() default StatementType.PREPARED;

    int fetchSize() default -1;

    int timeout() default -1;

    boolean useGeneratedKeys() default false;

    String keyProperty() default "";

    String keyColumn() default "";

    String resultSets() default "";

    String databaseId() default "";

    @Documented
    @Retention(RetentionPolicy.RUNTIME)
    @Target({ElementType.METHOD})
    public @interface List {
        Options[] value();
    }

    public static enum FlushCachePolicy {
        DEFAULT,
        TRUE,
        FALSE;

        private FlushCachePolicy() {
        }
    }
}
```

## JVM参数

JVM参考文章：https://www.cnblogs.com/ceshi2016/p/8447989.html

```java
// Xms 是指设定程序启动时占用内存大小
-Xms512m
// Xmx 是指设定程序运行期间最大可占用的内存大小
-Xmx5000m
// Xss 是指设定每个线程的堆栈大小
// Xmn 是指设置年轻代大小
-XX:ReservedCodeCacheSize=512m
-XX:+UseG1GC
-XX:SoftRefLRUPolicyMSPerMB=50
-XX:CICompilerCount=2
-XX:+HeapDumpOnOutOfMemoryError
-XX:-OmitStackTraceInFastThrow
-ea
-Dsun.io.useCanonCaches=false
-Djdk.http.auth.tunneling.disabledSchemes=""
-Djdk.attach.allowAttachSelf=true
-Djdk.module.illegalAccess.silent=true
-Dkotlinx.coroutines.debug=off
// 运行控制台输入
-Deditable.java.test.console=true
```
